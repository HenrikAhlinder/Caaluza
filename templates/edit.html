<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit LEGO Construction</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <link rel="stylesheet" href="/static/css/edit.css">
</head>
<body>
    <canvas id="three-canvas"></canvas>

    <!-- Brick Selector -->
    <div class="brick-selector-container">
        <button class="brick-selector-toggle" id="brick-selector-toggle">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
            </svg>
            Bricks
            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5z"/>
            </svg>
        </button>
        <div class="brick-selector" id="brick-selector">
            <strong>Bricks:</strong>
            {% for color in colors %}
            <div class="color-header">{{ color.name }}</div>
            <div class="size-container">
                {% for size in sizes %}
                <button class="size-button" title="{{ size.name }} {{ color.name }}">
                    {{ size.name }}
                </button>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- View Buttons -->
    <div class="button-container">
        {% for view in views %}
        <button class="view-button {{ view.name }}" data-position="{{ view.position }}">
            {% if view.name == 'Top' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l10 10-10 10L2 12z"/>
                </svg>
            {% elif view.name == 'Front' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7v10c0 5.55 3.84 10 9 11 1.09-.87 2-7.34 2-9H9V7h4c0-1.66.34-3 2-3z"/>
                </svg>
            {% elif view.name == 'Right' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"/>
                </svg>
            {% elif view.name == 'Back' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            {% elif view.name == 'Left' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            {% elif view.name == 'Perspective' %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 5-5v10zm2-4.5l-3-3 3-3v6zm6-1.5l-5 5V7l5 5z"/>
                </svg>
            {% else %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="10"/>
                </svg>
            {% endif %}
            {{ view.name }}
        </button>
        {% endfor %}
    </div>

    <!-- Zoom Controls -->
    <div class="zoom-controls">
        <button id="zoom-in-btn" class="zoom-button" title="Zoom In">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
        </button>
        <button id="zoom-out-btn" class="zoom-button" title="Zoom Out">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13H5v-2h14v2z"/>
            </svg>
        </button>
    </div>

    <!-- Title Display -->
    <div class="title-display-container">
        <div class="title-display-box">
            <span class="title-display-text" id="title-display">Untitled Map</span>
        </div>
    </div>

    <!-- Modal for Save/Load Prompts -->
    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Enter Title</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="modal-input" placeholder="Enter map title..." maxlength="50">
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="modal-button cancel-button">Cancel</button>
                <button id="modal-confirm" class="modal-button confirm-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Save and Load Buttons -->
    <button id="save-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
        </svg>
        Save
    </button>
    <button id="load-btn" class="load-button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
        Load
    </button>
    <button id="generate-btn" class="gen-button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z"/>
        </svg>
        Generate
    </button>

    <script>
        const views = {{ views | tojson }};
        const sizes = {{ sizes | tojson }};
        const colors = {{ colors | tojson }};
        const existingMap = {{ existing_map | tojson if existing_map else 'null' }};
        const mode = {{ mode | tojson if mode else "edit" }}
        const selectedView = {{ selected_view | tojson if selected_view else 'null' }}

        // Initialize brick selector dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('brick-selector-toggle');
            const selector = document.getElementById('brick-selector');

            if (toggle && selector) {
                toggle.addEventListener('click', function() {
                    selector.classList.toggle('show');
                    const arrow = toggle.querySelector('.dropdown-arrow path');
                    if (selector.classList.contains('show')) {
                        arrow.setAttribute('d', 'M7 14l5-5 5 5z');
                    } else {
                        arrow.setAttribute('d', 'M7 10l5 5 5 5z');
                    }
                });
            }
        });
    </script>
    <script type="module" src="/static/js/edit.js"></script>
</body>
</html>
