<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit LEGO Construction</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <link rel="stylesheet" href="/static/css/edit.css">
</head>
<body>
    <canvas id="three-canvas"></canvas>

    <!-- Brick Selector -->
    <div class="brick-selector-container">
        <button class="brick-selector-toggle" id="brick-selector-toggle">Bricks ▼</button>
        <div class="brick-selector" id="brick-selector">
            <strong>Bricks:</strong>
            {% for color in colors %}
            <div class="color-header">{{ color.name }}</div>
            <div class="size-container">
                {% for size in sizes %}
                <button class="size-button" title="{{ size.name }} {{ color.name }}">
                    {{ size.name }}
                </button>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- View Buttons -->
    <div class="button-container">
        {% for view in views %}
        <button class="view-button {{ view.name }}" data-position="{{ view.position }}">{{ view.name }}</button>
        {% endfor %}
    </div>

    <!-- Zoom Controls -->
    <div class="zoom-controls">
        <button id="zoom-in-btn" class="zoom-button" title="Zoom In">+</button>
        <button id="zoom-out-btn" class="zoom-button" title="Zoom Out">−</button>
    </div>

    <!-- Title Display -->
    <div class="title-display-container">
        <div class="title-display-box">
            <span class="title-display-text" id="title-display">Untitled Map</span>
        </div>
    </div>

    <!-- Modal for Save/Load Prompts -->
    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Enter Title</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="modal-input" placeholder="Enter map title..." maxlength="50">
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="modal-button cancel-button">Cancel</button>
                <button id="modal-confirm" class="modal-button confirm-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Save and Load Buttons -->
    <button id="save-btn">Save</button>
    <button id="load-btn" class="load-button">Load</button>
    <button id="generate-btn" class="gen-button">Generate</button>

    <script>
        const views = {{ views | tojson }};
        const sizes = {{ sizes | tojson }};
        const colors = {{ colors | tojson }};
        const existingMap = {{ existing_map | tojson if existing_map else 'null' }};
        const mode = {{ mode | tojson if mode else "edit" }}

        // Initialize brick selector dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('brick-selector-toggle');
            const selector = document.getElementById('brick-selector');

            if (toggle && selector) {
                toggle.addEventListener('click', function() {
                    selector.classList.toggle('show');
                    toggle.textContent = selector.classList.contains('show') ? 'Bricks ▲' : 'Bricks ▼';
                });
            }
        });
    </script>
    <script type="module" src="/static/js/edit.js"></script>
</body>
</html>
